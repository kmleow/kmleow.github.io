<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-eval' 'unsafe-inline' data: https:; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https:; object-src 'self'"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>LAMP stack on Raspberry Pi with Kodi running at startup</title><meta name="msvalidate.01" content="009F12474AB330989749B979B5868A7F"/><meta name="google-site-verification" content="in8GfCIv-CYlwD5AxO0jVMlrUy1s42a_-cxlOWdv4U0"/><meta name="yandex-verification" content="c29e9c1084b24e1d"/><meta name="description" content="I needed Kodi to run at startup with LAMP stack running behind and chose the NOOBS Raspbian route"/><meta name="author" content="Leow Kah Man"/><link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="canonical" href="https://www.leowkahman.com/2016/03/05/lamp-stack-on-raspberry-pi-with-kodi-running-at-startup/"><link href="" rel="alternate" type="application/rss+xml" title="Leow Kah Man - Tech Blog"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous"/><link rel="stylesheet" href="/css/custom.css?v=1.0.0"/><style id="antiClickjack">body{display:none!important}</style><script>if(self===top){var antiClickjack=document.getElementById("antiClickjack");antiClickjack.parentNode.removeChild(antiClickjack)}else top.location=self.location</script><script>function redirectToCorrectDomainIfRequired(){for(var o=["www.leowkahman.com","localhost"],e=0;e<o.length;e++)if(window.location.hostname==o[e])return;window.location="https://www.leowkahman.com"+window.location.pathname}redirectToCorrectDomainIfRequired()</script></head><body><nav class="navbar navbar-default navbar-static-top"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">Leow Kah Man - Tech Blog</a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/contact/">Contact</a></li></ul></div></div></nav><div class="container"><div class="row"><div class="col-sm-12"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="7600784826" data-ad-format="auto"></ins></div></div><div class="row"><div class="col-sm-8 blog-main"><div class="row"><div class="blog-main blog-post"><h1 class="blog-post-title">LAMP stack on Raspberry Pi with Kodi running at startup</h1><p class="blog-post-meta"><i class="fa fa-calendar"></i> Last updated on 26 September 2017 &nbsp; <i class="fa fa-folder"></i> <a href="https://www.leowkahman.com/categories/web">Web</a></p><ul class="list-inline share" style="margin-top:15px;margin-left:0"><li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.leowkahman.com%2f2016%2f03%2f05%2flamp-stack-on-raspberry-pi-with-kodi-running-at-startup%2f"><i class="fa fa-facebook fa-lg"></i> Facebook</a></li><li class="googleplus-share"><a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2016%2f03%2f05%2flamp-stack-on-raspberry-pi-with-kodi-running-at-startup%2f"><i class="fa fa-google-plus fa-lg"></i> Google+</a></li><li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2016%2f03%2f05%2flamp-stack-on-raspberry-pi-with-kodi-running-at-startup%2f&amp;text=LAMP%20stack%20on%20Raspberry%20Pi%20with%20Kodi%20running%20at%20startup"><i class="fa fa-twitter fa-lg"></i> Twitter</a></li><li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=https%3a%2f%2fwww.leowkahman.com%2f2016%2f03%2f05%2flamp-stack-on-raspberry-pi-with-kodi-running-at-startup%2f&amp;title=LAMP%20stack%20on%20Raspberry%20Pi%20with%20Kodi%20running%20at%20startup"><i class="fa fa-reddit fa-lg"></i> Reddit</a></li><li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.leowkahman.com%2f2016%2f03%2f05%2flamp-stack-on-raspberry-pi-with-kodi-running-at-startup%2f"><i class="fa fa-linkedin fa-lg"></i> LinkedIn</a></li></ul><p>For most people, if they wanted to run LAMP stack on Raspberry Pi, they would probably install Raspbian via NOOBS. However, if they wanted a HTPC with Kodi, they would likely opt for OSMC or OpenELEC. I needed Kodi to run at startup with LAMP stack running behind and chose the NOOBS Raspbian route.</p><p></p><h2 id="hardware">Hardware</h2><p>I am using Sandisk 8GB Class 4 on Pi 2 Model B. Initially, I was using Sandisk 16GB Class 10 but I am re-purposing it for some other usage.</p><p>For my use case, the Class 4 card is not the best though certainly not a bad choice. Good Micro SD cards outperform spindle hard disks when measuring in seek time which allows quicker random access. Google for this subject and you should find many <a href="https://www.google.com/search?q=raspbian+sd+benchmark">discussions</a>.</p><p>As for raw throughput, the results of the benchmark:</p><pre><code class="language-bash">sudo hdparm -tT /dev/mmcblk0
</code></pre><pre><code class="language-bash">/dev/mmcblk0:
Timing cached reads: 738 MB in 2.00 seconds = 368.52 MB/sec
Timing buffered disk reads: 66 MB in 3.09 seconds = 21.38 MB/sec
</code></pre><p>I hooked a keyboard mouse combo, Logitech K400 and attached CAT5 Ethernet cable.</p><h2 id="installing-raspbian-via-noobs">Installing Raspbian via NOOBS</h2><p>Follow the <a href="https://www.raspberrypi.org/help/noobs-setup/">NOOBS setup guide</a> on Raspberry official homepage. I must emphasis that the SD card should be formatted using SD Formatter tool as specified in the guide because NOOBS threw an error saying size was different or something like that so be sure not to skip this step!</p><p>Raspbian comes with many apps that I do not need. To uninstall:</p><pre><code class="language-bash">sudo apt-get purge -y libreoffice scratch minecraft-pi bluej greenfoot sonic-pi wolfram-engine idle idle3 claws-mail
sudo apt-get autoremove -y
</code></pre><p>To ensure remaining apps are up-to-date:</p><pre><code class="language-bash">sudo apt-get update
sudo apt-get upgrade
</code></pre><h2 id="disable-booting-to-desktop">Disable booting to desktop</h2><p>Since I want Kodi to run at startup, there is no need for the desktop to show up.</p><p>Bring up Raspberry Pi configuration tool:</p><pre><code class="language-bash">sudo raspi-config
</code></pre><p>Then go to <code>Boot Options</code>. Choose either <code>Console</code> or <code>Console Autologin</code>. The Autologin was useless to me because I usually manage my Pi via SSH.</p><p>You should change the default password. Go to <code>Change User Password</code>.</p><h2 id="installing-apache-mysql-and-php">Installing Apache, MySQL and PHP</h2><p>There are way too many guides of such. For simplicity, my recommendation is to follow the guide on Raspberry homepage, <a href="https://www.raspberrypi.org/learning/lamp-web-server-with-wordpress/">Build a LAMP Web Server with WordPress</a>.</p><h2 id="setup-firewall">Setup firewall</h2><p>The simplest tool is UncomplicatedFirewall (UFW). It encapsulates the complexity of <code>iptables</code> command.</p><pre><code class="language-bash">sudo apt-get install ufw -y
</code></pre><p>To disallow all incoming traffic by default:</p><pre><code class="language-bash">sudo ufw default deny incoming
</code></pre><p>To allow all outgoing traffic by default:</p><pre><code class="language-bash">sudo ufw default allow outgoing
</code></pre><p>To allow all incoming traffic from any machine on LAN (with assumption you are on 192.168.0.x subnet otherwise, change accordingly):</p><pre><code class="language-bash">sudo ufw allow from 192.168.0.0/24
</code></pre><p>To enable the firewall:</p><pre><code class="language-bash">sudo ufw enable
</code></pre><p>If you got kicked out from the SSH session, you have misconfigured the LAN subnet in the previous step. The only way back in is to hook a keyboard and screen to Pi to fix the problem.</p><p>To allow incoming HTTP and HTTPS traffic from any IP:</p><pre><code class="language-bash">sudo ufw allow http
sudo ufw allow https
</code></pre><h2 id="installing-kodi">Installing Kodi</h2><p>Before you begin, the GPU on Pi 2 needs sufficient memory and many publicly available articles have pointed 160MB to be the sweet spot.</p><p>Bring up Pi configuration tool again:</p><pre><code class="language-bash">sudo raspi-config
</code></pre><p>Then go to <code>Advanced Options &gt; Memory Split</code> and enter <code>160</code>.<br/>You will be prompted to reboot, agree to it.</p><p>To install kodi:</p><pre><code class="language-bash">sudo apt-get install kodi -y
</code></pre><p>If you prefer Kodi to run on startup, you need to edit <code>/etc/default/kodi</code> and change <code>ENABLED=0</code> to <code>ENABLED=1</code>. The simplest editor is <code>nano</code>:</p><pre><code class="language-bash">sudo nano /etc/default/kodi
</code></pre><p>Verify that Kodi can start as a service:</p><pre><code class="language-bash">sudo service kodi start
</code></pre><p>Noticed that in <code>/etc/default/kodi</code>, the user to run Kodi as is <code>kodi</code>.</p><p>In order for a full-sized keyboard to behave as it should in Kodi, you need to grant permission: <code>sudo nano /etc/udev/rules.d/99-com.rules</code> and add <code>KERNEL==&quot;tty[0-9]*&quot;, GROUP=&quot;tty&quot;, MODE=&quot;0660&quot;</code>. Reboot to test that it takes effect.</p><h2 id="internationalisation">Internationalisation</h2><p>If you need Raspbian to display Chinese, Japanese, Korean (and/or other) characters in file names, you need to enable some fonts. Run <code>sudo raspi-config</code> then go to <code>Internationalisation Options &gt; Change Locale</code>. Add the following:</p><ul><li>ja_JP.UTF-8</li><li>ko_KR.UTF-8</li><li>zh_CN.UTF-8</li><li>zh_TW.UTF-8</li></ul><p>Be sure to keep en_US.UTF-8 as your default if you do want it to be.</p><p>In Kodi, go to <code>Settings &gt; Appearance &gt; Skin &gt; Fonts</code> and select <code>Arial</code>.</p><h2 id="improving-performance">Improving performance</h2><p>If you have reached this point, you have working LAMP stack and Kodi. If you are interested in maximising the ability of Pi, read on.</p><h3 id="buy-mpeg-2-license-key">Buy MPEG-2 license key</h3><p>Kodi runs fine out of the box but I needed it to utilise the GPU so that the CPU can be offloaded to run LAMP quicker. For this, I purchased <a href="http://www.raspberrypi.com/mpeg-2-license-key/">MPEG-2 license key from Raspberry</a> and waited for a day to receive the license via email.</p><p>To activate the key, edit the boot config:</p><pre><code class="language-bash">sudo nano /boot/config.txt
</code></pre><p>and add <code>decode_MPG2=&lt;license&gt;</code> at the end of file replacing <code>&lt;license&gt;</code> with the actual license.</p><h3 id="disable-swap-file">Disable swap file</h3><p>You may ask, why?</p><ol><li>To improve longevity of the micro SD card by not using it as virtual memory.</li><li>To save space on the micro SD card by not having a swap file.</li></ol><p>Convinced? Do the following:</p><pre><code class="language-bash">sudo dphys-swapfile swapoff
sudo dphys-swapfile uninstall
sudo update-rc.d dphys-swapfile remove
</code></pre><p>To check available free memory:</p><pre><code class="language-bash">free -m
</code></pre><p>I have in excess of 500MB on my Pi 2 Model B with LAMP stack and Kodi running.</p><ul class="list-inline tags" style="margin-left:0"><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/apache">Apache</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/firewall">Firewall</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/kodi">Kodi</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/lamp">LAMP</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/mysql">MySQL</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/php">PHP</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/raspberry-pi">Raspberry Pi</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/raspbian">Raspbian</a></li></ul></div></div><div class="blog-post"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="8937917223" data-ad-format="auto"></ins></div><div class="row"><div class="blog-post"><div id="disqus_thread"></div><script>!function(){if("localhost"!=window.location.hostname){var e=document.createElement("script");e.type="text/javascript",e.async=!0;e.src="https://leowkahman.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}else document.write("Disqus comments are unavailable while serving on localhost or 127.0.0.1")}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></div><div class="col-sm-4 blog-sidebar"><div class="sidebar-module"><script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx=partner-pub-8585963436723502:5716828028";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><gcse:search></gcse:search></div><div class="sidebar-module"><h4>Recent Posts</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/2017/09/23/checklist-for-switching-from-windows-to-linux/">Checklist for switching from Windows to Linux</a></li><li><a href="https://www.leowkahman.com/2017/09/11/enforce-safe-search-on-google-youtube-bing/">Enforce Safe Search on Google, YouTube, Bing</a></li><li><a href="https://www.leowkahman.com/2017/09/10/gitlab-ci-remove-priority-zero-from-hugo-sitemap/">GitLab CI remove priority zero from Hugo sitemap</a></li><li><a href="https://www.leowkahman.com/2017/09/09/gitlab-ci-push-output-to-github/">GitLab CI push output to GitHub</a></li><li><a href="https://www.leowkahman.com/2017/09/05/tm-streamyx-router-wifi-security/">TM Streamyx Router Wi-Fi Security</a></li></ul></div><div class="sidebar-module"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="6069940020" data-ad-format="auto"></ins></div><div class="sidebar-module"><h4>Categories</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/categories/web/">web</a></li><li><a href="https://www.leowkahman.com/categories/network/">network</a></li><li><a href="https://www.leowkahman.com/categories/software/">software</a></li><li><a href="https://www.leowkahman.com/categories/hardware/">hardware</a></li><li><a href="https://www.leowkahman.com/categories/cloud/">cloud</a></li></ul></div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm-8 col-xs-6"><ul class="list-inline links"><li><a href="https://status.leowkahman.com/">Uptime</a></li></ul></div><div class="col-sm-4 col-xs-6"><ul class="list-inline"><li><a target="_blank" href="/index.xml"><i class="fa fa-rss fa-lg"></i></a></li><li><a target="_blank" href="https://stackexchange.com/users/6729082/leow-kah-man"><i class="fa fa-stack-exchange fa-lg"></i></a></li><li><a target="_blank" href="https://github.com/kmleow"><i class="fa fa-github fa-lg"></i></a></li><li><a target="_blank" href="https://www.linkedin.com/in/kmleow"><i class="fa fa-linkedin fa-lg"></i></a></li><li><a target="_blank" href="https://www.facebook.com/LeowKahMan"><i class="fa fa-facebook fa-lg"></i></a></li></ul></div></div></div><div class="container"><div class="col-sm-12 row"><p>Except as otherwise noted, the content of this page is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License </a>,<br/>code samples are licensed under the <a href="https://tldrlegal.com/license/mit-license">MIT License</a>.</p></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha256-Daf8GuI2eLKHJlOWLRR/zRy9Clqcj4TUSumbxYH9kGI=" crossorigin="anonymous"></script><script src="/js/custom.js?v=1.0.0"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>[].forEach.call(document.querySelectorAll(".adsbygoogle"),function(){(adsbygoogle=window.adsbygoogle||[]).push({})})</script><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-61838818-1","auto"),ga("send","pageview"),ga("set","forceSSL",!0)</script></body></html>