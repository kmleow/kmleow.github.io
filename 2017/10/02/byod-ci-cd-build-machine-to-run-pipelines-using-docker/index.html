<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-eval' 'unsafe-inline' data: https:; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https:; object-src 'self'"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>BYOD CI/CD build machine to run pipelines using Docker</title><meta name="msvalidate.01" content="009F12474AB330989749B979B5868A7F"/><meta name="google-site-verification" content="in8GfCIv-CYlwD5AxO0jVMlrUy1s42a_-cxlOWdv4U0"/><meta name="yandex-verification" content="c29e9c1084b24e1d"/><meta name="description" content="Bring your own device (BYOD) CI/CD build machine to run pipelines using Docker."/><meta name="author" content="Leow Kah Man"/><link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="canonical" href="https://www.leowkahman.com/2017/10/02/byod-ci-cd-build-machine-to-run-pipelines-using-docker/"><link href="" rel="alternate" type="application/rss+xml" title="Leow Kah Man - Tech Blog"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous"/><link rel="stylesheet" href="/css/custom.css?v=1.0.0"/><style id="antiClickjack">body{display:none!important}</style><script>if(self===top){var antiClickjack=document.getElementById("antiClickjack");antiClickjack.parentNode.removeChild(antiClickjack)}else top.location=self.location</script><script>function redirectToCorrectDomainIfRequired(){for(var o=["www.leowkahman.com","localhost"],e=0;e<o.length;e++)if(window.location.hostname==o[e])return;window.location="https://www.leowkahman.com"+window.location.pathname}redirectToCorrectDomainIfRequired()</script></head><body><nav class="navbar navbar-default navbar-static-top"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">Leow Kah Man - Tech Blog</a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/contact/">Contact</a></li></ul></div></div></nav><div class="container"><div class="row"><div class="col-sm-12"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="7600784826" data-ad-format="auto"></ins></div></div><div class="row"><div class="col-sm-8 blog-main"><div class="row"><div class="blog-main blog-post"><h1 class="blog-post-title">BYOD CI/CD build machine to run pipelines using Docker</h1><p class="blog-post-meta"><i class="fa fa-calendar"></i> Published: 2 October 2017 &nbsp;|&nbsp; <i class="fa fa-calendar-check-o"></i> Last updated: 3 October 2017 &nbsp;|&nbsp; <i class="fa fa-folder"></i> <a href="https://www.leowkahman.com/categories/software">Software</a></p><ul class="list-inline share" style="margin-top:15px;margin-left:0"><li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.leowkahman.com%2f2017%2f10%2f02%2fbyod-ci-cd-build-machine-to-run-pipelines-using-docker%2f"><i class="fa fa-facebook fa-lg"></i> Facebook</a></li><li class="googleplus-share"><a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f10%2f02%2fbyod-ci-cd-build-machine-to-run-pipelines-using-docker%2f"><i class="fa fa-google-plus fa-lg"></i> Google+</a></li><li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f10%2f02%2fbyod-ci-cd-build-machine-to-run-pipelines-using-docker%2f&amp;text=BYOD%20CI%2fCD%20build%20machine%20to%20run%20pipelines%20using%20Docker"><i class="fa fa-twitter fa-lg"></i> Twitter</a></li><li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f10%2f02%2fbyod-ci-cd-build-machine-to-run-pipelines-using-docker%2f&amp;title=BYOD%20CI%2fCD%20build%20machine%20to%20run%20pipelines%20using%20Docker"><i class="fa fa-reddit fa-lg"></i> Reddit</a></li><li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f10%2f02%2fbyod-ci-cd-build-machine-to-run-pipelines-using-docker%2f"><i class="fa fa-linkedin fa-lg"></i> LinkedIn</a></li></ul><p>Skip the build queue and save money by reducing (if not eliminating) dedicated build machines by Bringing Your Own Device (BYOD) as CI/CD build machine to run pipelines using Docker.</p><p></p><h2 id="motivation">Motivation</h2><p>I have been <a href="/2017/08/15/hugo-static-site-generator-with-ci-deployment-using-gitlab">utilising GitLab to build and host my blog since mid of August 2017</a>. They offer 2000 hours of free build time per month. Occasionally, I found that my build was queued up to slightly over 10 minutes. Build time also fluctuates between a low of 1 minute and a high of 2.5 minutes. Understandably, these are shared runners with varying machine specifications. Usually, the build runs as soon as code gets pushed into remote branch.</p><p>Last weekend, I read that it is possible to <a href="https://docs.gitlab.com/runner/register/index.html">register my own build runner into GitLab</a> so I decided to give it a try.</p><h2 id="steps">Steps</h2><h3 id="install-docker">Install Docker</h3><p>What is Docker?</p><blockquote><p>Docker is the world’s leading software container platform. Developers use Docker to eliminate “works on my machine” problems when collaborating on code with co-workers. Operators use Docker to run and manage apps side-by-side in isolated containers to get better compute density. Enterprises use Docker to build agile software delivery pipelines to ship new features faster, more securely and with confidence for both Linux, Windows Server, and Linux-on-mainframe apps.</p></blockquote><p><em>Source: <a href="https://www.docker.com/what-docker">https://www.docker.com/what-docker</a></em></p><p>With Docker, you can run builds on a container. Trusted containers can be found on <a href="https://store.docker.com/">Docker Store</a>. In my case, I use NodeJS image as it comes with <code>npm</code>. This gives me access to a huge library of Node modules useful for running my builds.</p><p>Follow the <a href="https://docs.docker.com/engine/installation/#server">Docker installation instructions</a>. Specifically, I installed <a href="https://www.docker.com/community-edition/">Docker Community Edition</a>.</p><h3 id="installing-gitlab-runner">Installing GitLab Runner</h3><p><a href="https://docs.gitlab.com/runner/install/index.html">GitLab Runner can be installed</a> onto a variety of operating systems including Raspberry Pi Raspbian Jessie.</p><p>See a list of <a href="https://hub.docker.com/r/arm32v7/">arm32v7 Docker images</a>. Notice that Node 8.6.0 Alpine image is not available, with the <a href="https://github.com/gliderlabs/docker-alpine/issues/304">issue still open on GitHub</a>. As an alternative, I switched to the default Node image:</p><pre><code class="language-yaml">image: node:8.6.0
</code></pre><p>I have tried the Slim variant but it does not have <code>git</code> which I need for <a href="/2017/09/09/gitlab-ci-push-output-to-github/">pushing the build output to GitHub</a>. If you do not need or you are not sure, give the Slim variant a try:</p><pre><code class="language-yaml">image: node:8.6.0-slim
</code></pre><h3 id="get-a-token-for-registering-a-runner">Get a token for registering a runner</h3><p>Go to your GitLab repository. Then click on <em>Settings</em> and navigate to <em>CI/CD</em>.</p><p>Next, Expand the <em>Runners settings</em>. You should be seeing <em>Specific Runners</em> and <em>Shared Runners</em>. Disable the latter.</p><p>Under Specific Runners, you should be seeing:<br/>&ldquo;Use the following registration token during setup: <code>&lt;your token&gt;</code>&rdquo;.<br/>You are going to need this token in the next step.</p><h3 id="registering-a-runner">Registering a runner</h3><p>Follow GitLab&rsquo;s instructions on <a href="https://docs.gitlab.com/runner/register/index.html">Registering Runners</a>.</p><p>In my case, I literally followed all instructions written there except tags association and disallow running untagged jobs. I tagged my runner with <code>docker,linux</code> following the pattern of tag names defined on shared runners.</p><h3 id="updating-gitlab-ci-yml">Updating .gitlab-ci.yml</h3><p>You need to add tags to your GitLab CI YAML file.</p><pre><code class="language-yaml">pages:
  tags:
  - docker
</code></pre><h3 id="testing">Testing</h3><p>Push your code to remote branch and watch the pipeline spring to life.</p><p>The first few lines of the output should be:</p><pre><code class="language-text">Running with gitlab-runner 10.0.0 (2055cfdc)
  on &lt;my machine name&gt; (&lt;runner ID&gt;)
Using Docker executor with image node:8.6.0-alpine ...
Using docker image sha256:60c6962e4e7c3e4390c8af1b833e3a9ed80aedcb2d933f7c04f77ccfed49ec62 for predefined container...
Pulling docker image node:8.6.0-alpine ...
Using docker image node:8.6.0-alpine ID=sha256:b7e15c83cdaf2bf47a6db862f342d8d176477e54cc271b0803e0f1c7273cd5a7 for build container...
</code></pre><p>The final few lines should be:</p><pre><code class="language-text">Uploading artifacts...
public: found &lt;number&gt; matching files                   
Uploading artifacts to coordinator... ok
</code></pre><p><em>Note: On first pull of a Docker image that you have not pulled down before.</em> <em>Build time is expected to be longer as the image has to be downloaded and</em> <em>cached locally. Subsequent pulls are taken from local cache.</em></p><h3 id="cleanup">Cleanup</h3><p>If you no longer have any use of one or more Docker images, you could save disk space by removing them.</p><p>To see a list of Docker images in your local cache:</p><pre><code class="language-bash">sudo docker images
</code></pre><p>To delete a specific Docker image from your local cache:</p><pre><code class="language-bash">sudo docker rmi &lt;IMAGE ID&gt;
</code></pre><ul class="list-inline tags" style="margin-left:0"><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/docker">Docker</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/gitlab">GitLab</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/linux">Linux</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/nodejs">NodeJS</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/raspberry-pi">Raspberry Pi</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/raspbian">Raspbian</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/windows">Windows</a></li></ul></div></div><div class="blog-post"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="8937917223" data-ad-format="auto"></ins></div><div class="row"><div id="disqus_thread"></div><script>!function(){if("localhost"!=window.location.hostname){var e=document.createElement("script");e.type="text/javascript",e.async=!0;e.src="https://leowkahman.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="col-sm-4 blog-sidebar"><div class="sidebar-module"><script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx=partner-pub-8585963436723502:5716828028";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><gcse:search></gcse:search></div><div class="sidebar-module"><h4>Recent Posts</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/2018/04/08/prevent-overheating-by-disabling-turbo-boost/">Prevent overheating by disabling turbo boost</a></li><li><a href="https://www.leowkahman.com/2018/03/31/how-to-fix-choppy-youtube-videos-on-old-laptop/">How to fix choppy YouTube videos on Firefox and Chrome on an old laptop</a></li><li><a href="https://www.leowkahman.com/2018/03/22/running-whatsapp-allo-todoist-onenote-on-ubuntu/">Running WhatsApp, Allo, Todoist, and OneNote on Ubuntu</a></li><li><a href="https://www.leowkahman.com/2018/03/13/using-raspbian-on-2gb-micro-sd-card/">Using Raspbian on 2GB Micro SD Card</a></li><li><a href="https://www.leowkahman.com/2018/03/09/lede-on-unifi-d-link-dir-615-g2/">LEDE on UniFi D-Link DIR-615 G2</a></li></ul></div><div class="sidebar-module"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="6069940020" data-ad-format="auto"></ins></div><div class="sidebar-module"><h4>Categories</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/categories/web/">web</a></li><li><a href="https://www.leowkahman.com/categories/software/">software</a></li><li><a href="https://www.leowkahman.com/categories/network/">network</a></li><li><a href="https://www.leowkahman.com/categories/hardware/">hardware</a></li><li><a href="https://www.leowkahman.com/categories/cloud/">cloud</a></li></ul></div><div class="sidebar-module"><div id="amzn-assoc-ad-2cb50066-d10a-485e-9416-70d5db8469a8"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=2cb50066-d10a-485e-9416-70d5db8469a8"></script></div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm-8 col-xs-6"><ul class="list-inline links"><li><a href="/privacy-policy/">Privacy Policy</a></li><li><a href="https://status.leowkahman.com/">Uptime</a></li></ul></div><div class="col-sm-4 col-xs-6"><ul class="list-inline"><li><a target="_blank" href="/index.xml"><i class="fa fa-rss fa-lg"></i></a></li><li><a target="_blank" href="https://stackexchange.com/users/6729082/leow-kah-man"><i class="fa fa-stack-exchange fa-lg"></i></a></li><li><a target="_blank" href="https://github.com/kmleow"><i class="fa fa-github fa-lg"></i></a></li><li><a target="_blank" href="https://twitter.com/kmleow"><i class="fa fa-twitter fa-lg"></i></a></li><li><a target="_blank" href="https://www.linkedin.com/in/kmleow"><i class="fa fa-linkedin fa-lg"></i></a></li><li><a target="_blank" href="https://www.facebook.com/LeowKahMan"><i class="fa fa-facebook fa-lg"></i></a></li><li><a target="_blank" href="https://www.paypal.me/leowkahman/5usd"><i class="fa fa-paypal fa-lg"></i></a></li></ul></div></div></div><div class="container"><div class="col-sm-12 row"><p>I am a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for sites to earn advertising fees by advertising and linking to amazon.com.</p><p>Except as otherwise noted, the content of this page is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>,<br/>code samples are licensed under the <a href="https://tldrlegal.com/license/mit-license">MIT License</a>. Third-party product names and logos may be the trademarks of their respective owners.</p></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha256-Daf8GuI2eLKHJlOWLRR/zRy9Clqcj4TUSumbxYH9kGI=" crossorigin="anonymous"></script><script src="/js/custom.js?v=1.0.1"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>[].forEach.call(document.querySelectorAll(".adsbygoogle"),function(){(adsbygoogle=window.adsbygoogle||[]).push({})})</script><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-61838818-1","auto"),ga("send","pageview"),ga("set","forceSSL",!0)</script></body></html>