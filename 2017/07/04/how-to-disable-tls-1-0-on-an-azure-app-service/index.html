<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-eval' 'unsafe-inline' data: https:; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https:; object-src 'self'"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>How to disable TLS 1.0 on an Azure App Service</title><meta name="msvalidate.01" content="009F12474AB330989749B979B5868A7F"/><meta name="google-site-verification" content="in8GfCIv-CYlwD5AxO0jVMlrUy1s42a_-cxlOWdv4U0"/><meta name="yandex-verification" content="c29e9c1084b24e1d"/><meta name="description" content="It is possible to disable TLS 1.0 and even 1.1 without using App Service Environment. The solution is to use Azure Application Gateway and a custom hostname."/><meta name="author" content="Leow Kah Man"/><link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="canonical" href="https://www.leowkahman.com/2017/07/04/how-to-disable-tls-1-0-on-an-azure-app-service/"><link href="" rel="alternate" type="application/rss+xml" title="Leow Kah Man - Tech Blog"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous"/><link rel="stylesheet" href="/css/custom.css?v=1.0.0"/><style id="antiClickjack">body{display:none!important}</style><script>if(self===top){var antiClickjack=document.getElementById("antiClickjack");antiClickjack.parentNode.removeChild(antiClickjack)}else top.location=self.location</script><script>function redirectToCorrectDomainIfRequired(){for(var o=["www.leowkahman.com","localhost"],e=0;e<o.length;e++)if(window.location.hostname==o[e])return;window.location="https://www.leowkahman.com"+window.location.pathname}redirectToCorrectDomainIfRequired()</script></head><body><nav class="navbar navbar-default navbar-static-top"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">Leow Kah Man - Tech Blog</a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/contact/">Contact</a></li></ul></div></div></nav><div class="container"><div class="row"><div class="col-sm-12"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="7600784826" data-ad-format="auto"></ins></div></div><div class="row"><div class="col-sm-8 blog-main"><div class="row"><div class="blog-main blog-post"><h1 class="blog-post-title">How to disable TLS 1.0 on an Azure App Service</h1><p class="blog-post-meta"><i class="fa fa-calendar"></i> Published: 4 July 2017 &nbsp;|&nbsp; <i class="fa fa-folder"></i> <a href="https://www.leowkahman.com/categories/software">Software</a></p><ul class="list-inline share" style="margin-top:15px;margin-left:0"><li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.leowkahman.com%2f2017%2f07%2f04%2fhow-to-disable-tls-1-0-on-an-azure-app-service%2f"><i class="fa fa-facebook fa-lg"></i> Facebook</a></li><li class="googleplus-share"><a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f07%2f04%2fhow-to-disable-tls-1-0-on-an-azure-app-service%2f"><i class="fa fa-google-plus fa-lg"></i> Google+</a></li><li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f07%2f04%2fhow-to-disable-tls-1-0-on-an-azure-app-service%2f&amp;text=How%20to%20disable%20TLS%201.0%20on%20an%20Azure%20App%20Service"><i class="fa fa-twitter fa-lg"></i> Twitter</a></li><li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f07%2f04%2fhow-to-disable-tls-1-0-on-an-azure-app-service%2f&amp;title=How%20to%20disable%20TLS%201.0%20on%20an%20Azure%20App%20Service"><i class="fa fa-reddit fa-lg"></i> Reddit</a></li><li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f07%2f04%2fhow-to-disable-tls-1-0-on-an-azure-app-service%2f"><i class="fa fa-linkedin fa-lg"></i> LinkedIn</a></li></ul><p><a href="/images/2017/07/tls-1-2-yes.png"><img src="/images/2017/07/tls-1-2-yes.png" alt="TLS 1.2 - yes"/></a></p><p>Yes it is possible to disable TLS 1.0 and even 1.1 without using App Service Environment (ASE). The solution is to use Azure Application Gateway and a custom hostname.</p><p></p><h2 id="motivation">Motivation</h2><p>I like using Platform as a Service (PaaS) because it abstracts the complexities of managing the underlying layer. Of course it does incur additional cost but this is usually not a showstopper. An example of a showstopper is when there is a special need to bring forward disabling of less secure cryptography protocols. Failure which, switching to a different hosting option has to be considered!</p><h2 id="disclaimer">Disclaimer</h2><p>Before jumping to the solution, I need to state that the way I am proposing is considered <em>not supported</em> by Azure.</p><h2 id="what-i-have-gathered">What I have gathered</h2><p>I know I am not alone in facing this issue and I have been Googleing monthly in search for a viable solution. As at 4th July 2017, below are points that I have found to date:</p><ul><li><a href="https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-faq">Application Gateway FAQ</a> states that <em>Support for Azure Web Apps is not available today.</em></li><li><a href="https://feedback.azure.com/forums/169385-web-apps/suggestions/7091994-disable-insecure-ciphers-in-azure-websites">RC4 has been disabled</a> but there are a few comments requesting for TLS 1.0 to be disabled along.</li><li>There was a request on Azure Feedback forum to <a href="https://feedback.azure.com/forums/169385-web-apps/suggestions/13097865-either-sun-set-tls-1-0-or-give-users-the-means-to">give users the means to disable TLS 1.0</a> but it was declined.</li><li>Another request to <a href="https://feedback.azure.com/forums/169385-web-apps/suggestions/10196898-allow-the-ability-to-disable-tls-1-0-so-we-can-pas">disable TLS 1.0 as these users are failing Trustwave Vulnerability scan</a> was marked completed when it has not.</li><li>Yet another request to <a href="https://feedback.azure.com/forums/169385-web-apps/suggestions/11158626-disable-tls1-0">disable TLS 1.0 but was marked completed with reference pointing to ASE</a>.</li></ul><h2 id="known-viable-options">Known viable options</h2><p>If you are fine with either of these:</p><ul><li>Switching to Web Role on Azure Cloud Service which then allows tweaking the underlying O/S layer to do whatever.</li><li>Upscaling to ASE and pay a price premium.</li></ul><h2 id="where-and-how-the-solution-was-derived">Where and how the solution was derived</h2><p>My solution involves use of Azure Application Gateway and <strong>a custom hostname</strong> over existing Web App.</p><p>The idea came after reading a comment by user <em>Gwallace@MSFT (moderator)</em> who stated the following comment on 18th May 2017:</p><blockquote><p>Application Gateway forwards the request to the backend with the same host header it receives from the client, this is an issue with backends that are listening on a different hostname, which can be the case with WebApps.</p></blockquote><p>The key bits are &ldquo;same host header&rdquo;.</p><p>In theory, it should work by doing the following:</p><ol><li>Custom hostname with CNAME to the gateway hostname.</li><li>The gateway backend pointing to Web App, <code>&lt;your website&gt;.azurewebsites.net</code>.</li><li>The Web App must serve content when HTTP Host header matches the custom hostname.</li></ol><p>I had to do a few extras so I would suggest following the steps below.</p><h2 id="steps">Steps</h2><h3 id="assumptions">Assumptions</h3><p>You have the following:</p><ol><li>An existing Web App on App Service Plan. Free plan is a no-go as it does not allow setting custom domain.</li><li>A domain name where you have control to create/update CNAME on a subdomain.</li><li>To qualify for <a href="https://azure.microsoft.com/en-us/support/legal/sla/application-gateway/">SLA, 2 or more instances of medium or larger App Gateway are required</a>. You understand the cost additions of adding this.</li></ol><h3 id="setup-app-service-custom-domain">Setup App Service custom domain</h3><ol><li>Setup a subdomain with CNAME to <code>&lt;your website&gt;.azurewebsites.net</code>. Note that DNS information may take up to 24 hours to propagate.</li><li>On Azure Portal, navigate to your <code>App Service</code>. Then go to <code>Custom domains</code>.</li><li>Next click on <code>Add hostname</code>. Enter the <a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name">FQDN</a> of your subdomain and click on <code>Validate</code>. Azure will perform an ownership check to ensure that you are the owner of the domain by checking your subdomain&rsquo;s CNAME record. Ensure this passes before proceeding!</li></ol><h3 id="setup-application-gateway">Setup Application Gateway</h3><ol><li>Add <code>Application Gateway</code>.</li><li>You are then informed the terms to qualify for SLA. Click on <code>Create</code>.</li><li><code>Standard</code> tier is fine. Choose <code>WAF</code> if you prefer.</li><li>The location should ideally be the same as per your App Service so that we can leverage on SSL termination.</li><li>Click <code>OK</code> to proceed.</li><li>Create a new <code>Virtual network</code> (or existing if you know what you are doing). You need to give a name. Address space, subnet name, and subnet address range have been prepropulated.</li><li>Frontend IP address type is set to <code>Public</code>.</li><li>Create a new <code>Public IP address</code>.</li><li>Set protocol to <code>HTTPS</code>. You will need to create another listener for <code>HTTP</code> later (if you want this too) but I am not demonstrating that to focus on disabling specific TLS versions. Port number will automatically be set to <code>443</code>. For testing purposes, I created a self-signed PFX which I will not detail as you can find plenty of tutorials elsewhere. The PFX must be password protected.</li><li>Click <code>OK</code> to proceed. Expect up to 20 minutes for gateway to be created.</li><li>Once the gateway has been created, navigate to <code>Overview</code> as further configuration is required.</li><li>Change the CNAME of your subdomain to point to your newly created frontend public IP address, <code>&lt;guid&gt;.cloudapp.net</code>.</li><li>Go to <code>Backend pools</code>. One has already been created named <code>appGatewayBackendPool</code>. Click on it then add <code>&lt;your website&gt;.azurewebsites.net</code>. Remember to click <code>Save</code>.</li><li>Go to <code>Health probes</code>. Add a new one that points to <code>&lt;your website&gt;.azurewebsites.net</code>. Root (/) path is fine. Click <code>Save</code>.</li><li>Go to <code>HTTP settings</code>. Check <code>Use custom probe</code> and point to the newly created probe.</li><li>Go to <code>Backend health</code>. Ensure that the status is <code>Healthy</code> otherwise you missed a step.</li></ol><h3 id="disabling-tls-1-0-and-1-1">Disabling TLS 1.0 and 1.1</h3><p>Firstly, verify the list of TLS protocol versions supported as-is. Go to Qualys SSL Labs <a href="https://www.ssllabs.com/ssltest/">SSL Server Test</a>. A warning will appear if you used a self-signed certificate. Choose to proceed. You should now be seeing TLS 1.0, 1.1 and 1.2 marked <code>Yes</code>.</p><p>Start <a href="https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-end-to-end-ssl-powershell">PowerShell and enter the following commands</a>. Please note in the example below both TLS 1.0 and 1.1 are to be disabled. You can omit the latter if you prefer to keep it supported:</p><pre><code class="language-powershell">$gw = Get-AzureRmApplicationGateway -Name &lt;your gateway name&gt; -ResourceGroupName &lt;your resource group&gt;
Set-AzureRmApplicationGatewaySslPolicy -DisabledSslProtocols TLSv1_0, TLSv1_1 -ApplicationGateway $gw
$gw | Set-AzureRmApplicationGateway
</code></pre><p>Once the last command has completed, perform a new SSL test and you should now be seeing just TLS 1.2 marked <code>Yes</code>.</p><ul class="list-inline tags" style="margin-left:0"><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/azure">Azure</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/tls">TLS</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/security">security</a></li></ul></div></div><div class="row"><h4>Support Me</h4><p>If this post helped you, would you buy me a cup of tea/coffee?</p><a href="https://www.paypal.me/leowkahman/12"><i class="fa fa-3x fa-cc-paypal"></i> </a>&nbsp;&nbsp; <a href="#btc" onclick='return document.getElementById("btc").style.display="block",!1'><i class="fa fa-3x fa-btc"></i> </a><span id="btc" style="display:none"><a href="bitcoin:14vH7vDj7eyvvc7mxCkrgTx2HUntpeKhAn?amount=0.001&amp;label=Tech%20Blog"><img src="/images/bitcoin.png"> 14vH7vDj7eyvvc7mxCkrgTx2HUntpeKhAn</a></span></div><div class="blog-post"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="8937917223" data-ad-format="auto"></ins></div><div class="row"><div id="disqus_thread"></div><script>!function(){if("localhost"!=window.location.hostname){var e=document.createElement("script");e.type="text/javascript",e.async=!0;e.src="https://leowkahman.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="col-sm-4 blog-sidebar"><div class="sidebar-module"><script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx=partner-pub-8585963436723502:5716828028";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><gcse:search></gcse:search></div><div class="sidebar-module"><h4>Recent Posts</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/2017/10/01/byod-ci-cd-build-machine-to-run-pipelines-using-docker/">BYOD CI/CD build machine to run pipelines using Docker</a></li><li><a href="https://www.leowkahman.com/2017/09/23/checklist-for-switching-from-windows-to-linux/">Checklist for switching from Windows to Linux</a></li><li><a href="https://www.leowkahman.com/2017/09/11/enforce-safe-search-on-google-youtube-bing/">Enforce Safe Search on Google, YouTube, Bing</a></li><li><a href="https://www.leowkahman.com/2017/09/10/gitlab-ci-remove-priority-zero-from-hugo-sitemap/">GitLab CI remove priority zero from Hugo sitemap</a></li><li><a href="https://www.leowkahman.com/2017/09/09/gitlab-ci-push-output-to-github/">GitLab CI push output to GitHub</a></li></ul></div><div class="sidebar-module"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="6069940020" data-ad-format="auto"></ins></div><div class="sidebar-module"><h4>Categories</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/categories/web/">web</a></li><li><a href="https://www.leowkahman.com/categories/network/">network</a></li><li><a href="https://www.leowkahman.com/categories/software/">software</a></li><li><a href="https://www.leowkahman.com/categories/hardware/">hardware</a></li><li><a href="https://www.leowkahman.com/categories/cloud/">cloud</a></li></ul></div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm-8 col-xs-6"><ul class="list-inline links"><li><a href="https://status.leowkahman.com/">Uptime</a></li></ul></div><div class="col-sm-4 col-xs-6"><ul class="list-inline"><li><a target="_blank" href="/index.xml"><i class="fa fa-rss fa-lg"></i></a></li><li><a target="_blank" href="https://stackexchange.com/users/6729082/leow-kah-man"><i class="fa fa-stack-exchange fa-lg"></i></a></li><li><a target="_blank" href="https://github.com/kmleow"><i class="fa fa-github fa-lg"></i></a></li><li><a target="_blank" href="https://www.linkedin.com/in/kmleow"><i class="fa fa-linkedin fa-lg"></i></a></li><li><a target="_blank" href="https://www.facebook.com/LeowKahMan"><i class="fa fa-facebook fa-lg"></i></a></li></ul></div></div></div><div class="container"><div class="col-sm-12 row"><p>Except as otherwise noted, the content of this page is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>,<br/>code samples are licensed under the <a href="https://tldrlegal.com/license/mit-license">MIT License</a>.</p></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha256-Daf8GuI2eLKHJlOWLRR/zRy9Clqcj4TUSumbxYH9kGI=" crossorigin="anonymous"></script><script src="/js/custom.js?v=1.0.1"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>[].forEach.call(document.querySelectorAll(".adsbygoogle"),function(){(adsbygoogle=window.adsbygoogle||[]).push({})})</script><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-61838818-1","auto"),ga("send","pageview"),ga("set","forceSSL",!0)</script></body></html>