<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Hugo Static Site Generator with CI Deployment using GitLab</title><meta name="msvalidate.01" content="009F12474AB330989749B979B5868A7F"/><meta name="google-site-verification" content="in8GfCIv-CYlwD5AxO0jVMlrUy1s42a_-cxlOWdv4U0"/><meta name="yandex-verification" content="c29e9c1084b24e1d"/><meta name="description" content="I now have a fully automated CI build on GitLab that grabs a NodeJS Docker image, downloads Hugo, UglifyCSS and HTMLMinifier via NPM, publishes to GitLab Pages."/><meta name="author" content="Leow Kah Man"/><link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="canonical" href="https://www.leowkahman.com/2017/08/15/hugo-static-site-generator-with-ci-deployment-using-gitlab/"><link href="" rel="alternate" type="application/rss+xml" title="Leow Kah Man - Tech Blog"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/vs.min.css" integrity="sha256-iGs2TpBtdfGr1FIgzGyO4CKAD1+2QaDswtMmJwDtHAs=" crossorigin="anonymous"/><link rel="stylesheet" href="/css/custom.css?v=1.0.0"/><style id="antiClickjack">body{display:none!important}</style><script>if(self===top){var antiClickjack=document.getElementById("antiClickjack");antiClickjack.parentNode.removeChild(antiClickjack)}else top.location=self.location</script><script>function redirectToCorrectDomainIfRequired(){for(var o=["www.leowkahman.com","localhost"],e=0;e<o.length;e++)if(window.location.hostname==o[e])return;window.location="https://www.leowkahman.com"+window.location.pathname}redirectToCorrectDomainIfRequired()</script></head><body><nav class="navbar navbar-default navbar-static-top"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">Leow Kah Man - Tech Blog</a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/contact/">Contact</a></li></ul></div></div></nav><div class="container"><div class="row"><div class="col-sm-8 blog-main"><div class="row"><div class="blog-main blog-post"><h1 class="blog-post-title">Hugo Static Site Generator with CI Deployment using GitLab</h1><p class="blog-post-meta"><i class="fa fa-calendar"></i> Published: 15 August 2017 &nbsp;|&nbsp; <i class="fa fa-calendar-check-o"></i> Last updated: 11 September 2017 &nbsp;|&nbsp; <i class="fa fa-folder"></i> <a href="https://www.leowkahman.com/categories/web">Web</a></p><ul class="list-inline share" style="margin-top:15px;margin-left:0"><li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.leowkahman.com%2f2017%2f08%2f15%2fhugo-static-site-generator-with-ci-deployment-using-gitlab%2f"><i class="fa fa-facebook fa-lg"></i> Facebook</a></li><li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f08%2f15%2fhugo-static-site-generator-with-ci-deployment-using-gitlab%2f&amp;text=Hugo%20Static%20Site%20Generator%20with%20CI%20Deployment%20using%20GitLab"><i class="fa fa-twitter fa-lg"></i> Twitter</a></li><li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f08%2f15%2fhugo-static-site-generator-with-ci-deployment-using-gitlab%2f&amp;title=Hugo%20Static%20Site%20Generator%20with%20CI%20Deployment%20using%20GitLab"><i class="fa fa-reddit fa-lg"></i> Reddit</a></li><li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f08%2f15%2fhugo-static-site-generator-with-ci-deployment-using-gitlab%2f"><i class="fa fa-linkedin fa-lg"></i> LinkedIn</a></li></ul><p>Over the weekend, I moved my blog from GitHub to GitLab. I now have a fully automated CI build on GitLab that grabs a NodeJS Docker image, downloads Hugo, UglifyCSS and HTMLMinifier via NPM, build and minify pages, and finally publishes to GitLab Pages on every Git merge to master.</p><h2 id="motivation">Motivation</h2><p>I have <a href="/2016/07/14/static-blog-generated-by-hugo-hosted-on-google-firebase">been using Hugo Static Site Generator</a> for over a year. Initially my blog was hosted on <a href="https://firebase.google.com/">Google Firebase</a>. Not long after, I moved to <a href="https://pages.github.com/">GitHub Pages</a> and been using it for over a year. Be it Firebase or GitHub, they both worked very well for me.</p><p>If they have been working, why fix what is not broken?</p><p>TL;DR, to automate chores.</p><p>For full explanation, let me start by explaining my old chores of composing and publishing a new blog post:</p><ol><li>Firstly, I compose a blog post in <a href="https://en.wikipedia.org/wiki/Markdown/">Markdown</a> using <a href="https://code.visualstudio.com/">Visual Studio Code</a>.</li><li>Also, run Hugo while composing as it will translate Markdown to HTML on-the-fly ready to viewed. I had the full command line in a batch file.</li><li>My blog&rsquo;s source files are then synchronised to a Git repository on <a href="https://cloud.google.com/source-repositories/">Google Cloud Source Repositories</a>.</li><li>When ready to publish, I execute Hugo without parameters to deploy to <code>public</code> folder. Then, minify CSS and HTML files. These commands were also in a batch file.</li><li>I then use <a href="https://www.freefilesync.org/">Free File Sync</a>, an open source folder synchronisation tool, to one-way-mirror the <code>public</code> folder to a local Git clone of my blog&rsquo;s published content on GitHub. Lastly, commit and push to remote master branch.</li></ol><p>I spent the weekend improving the end-to-end process as much as I could.</p><h2 id="what-why-and-how-to-automate">What, why and how to automate</h2><h3 id="one-git-repository-for-both-source-and-published-content">One Git repository for both source and published content</h3><p>Table below shows comparison among free tier options:</p><table><thead><tr><th align="left"></th><th align="left">Google Cloud Repository</th><th align="left">GitHub Pages</th><th align="left">GitLab Pages</th></tr></thead><tbody><tr><td align="left">Storage</td><td align="left">1GB</td><td align="left"><a href="https://help.github.com/articles/what-is-github-pages/">1GB</a></td><td align="left"><a href="https://about.gitlab.com/2015/04/08/gitlab-dot-com-storage-limit-raised-to-10gb-per-repo/">10GB</a></td></tr><tr><td align="left">Bandwidth per month</td><td align="left">10GB</td><td align="left"><a href="https://help.github.com/articles/what-is-github-pages/">100GB</a></td><td align="left"><a href="https://about.gitlab.com/2015/04/08/gitlab-dot-com-storage-limit-raised-to-10gb-per-repo/">Unlimited</a></td></tr><tr><td align="left">Private repository</td><td align="left">Yes</td><td align="left">No</td><td align="left">Yes</td></tr><tr><td align="left">Public repository</td><td align="left">No</td><td align="left">Yes</td><td align="left">Yes</td></tr><tr><td align="left">Static site generator</td><td align="left">No</td><td align="left">Jekyll</td><td align="left">Any*</td></tr></tbody></table><p>*<em>Possible through the use of Docker images for CI builds.</em> <em>See <a href="https://gitlab.com/pages/">example websites hosted by GitLab Pages</a>.</em></p><h3 id="which-docker-image-to-use-and-why">Which Docker image to use and why</h3><p>I compared 3 different GitLab CI configurations. Configurations are in <a href="http://yaml.org/">YAML</a> format:</p><ol><li>GitLab&rsquo;s example</li><li>Hugo&rsquo;s example</li><li>My approach</li></ol><h4 id="gitlabs-example">GitLab&rsquo;s example</h4><p><a href="https://gitlab.com/pages/hugo/blob/master/.gitlab-ci.yml">GitLab&rsquo;s example</a> uses a very small Docker image, Alpine Linux. The size is just 5MB.</p><p>The key lines are as follows:</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">image</span>: alpine
<span style="color:#66d9ef">variables</span>:
  <span style="color:#66d9ef">HUGO_VERSION</span>: <span style="color:#e6db74">&#39;0.23&#39;</span>
  <span style="color:#66d9ef">HUGO_SHA</span>: <span style="color:#e6db74">&#39;c9cf515067f396807161466c9968f10e61f762f49d766215db37b01402ca7ca7&#39;</span>
<span style="color:#66d9ef">before_script</span>:
  - apk update <span style="color:#75715e">&amp;&amp;</span> apk add openssl ca-certificates
  - wget -O ${HUGO_VERSION}.tar.gz https://github.com/spf13/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.tar.gz
  - echo <span style="color:#e6db74">&#34;${HUGO_SHA}  ${HUGO_VERSION}.tar.gz&#34;</span> | sha256sum -c
  - tar xf ${HUGO_VERSION}.tar.gz <span style="color:#75715e">&amp;&amp;</span> mv hugo* /usr/bin/hugo
  - hugo version
</code></pre></div><p>The variables need to be configured. They are <code>HUGO_VERSION</code> which is the version to download and <code>HUGO_SHA</code> which is a SHA256 hash of the Hugo release.</p><p>It will get you going if you need just the bare minimum.</p><h4 id="hugos-example">Hugo&rsquo;s example</h4><p><a href="https://gohugo.io/hosting-and-deployment/hosting-on-gitlab/">Hugo&rsquo;s example</a> eliminates the need to maintain the YAML file by not needing to update version and SHA256 checksum of Hugo releases. Its Docker image already has Hugo in it.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">image</span>: publysher/hugo

<span style="color:#66d9ef">pages</span>:
  <span style="color:#66d9ef">script</span>:
  - hugo
  <span style="color:#66d9ef">artifacts</span>:
    <span style="color:#66d9ef">paths</span>:
    - public
  <span style="color:#66d9ef">only</span>:
  - master
</code></pre></div><p>This approach is the most simplified option that I could find.</p><h4 id="my-approach">My approach</h4><p>I setup my <code>.gitlab-ci.yml</code> to use NodeJS Alpine Docker image.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">image</span>: node:<span style="color:#ae81ff">6.11.2</span>-alpine
<span style="color:#66d9ef">before_script</span>:
  - apk update <span style="color:#75715e">&amp;&amp;</span> apk add openssl ca-certificates
  - npm install
  - PATH=$(npm bin):$PATH
  - hugo version
<span style="color:#66d9ef">pages</span>:
  <span style="color:#66d9ef">script</span>:
  - npm run build
  <span style="color:#66d9ef">artifacts</span>:
    <span style="color:#66d9ef">paths</span>:
    - public
  <span style="color:#66d9ef">only</span>:
  - master
</code></pre></div><p>Undoubtedly more complicated than the other two options but there are reasons.</p><p>I leveraged on <a href="https://www.npmjs.com/">NodeJS NPM Package Manager</a> to install Hugo binary as well as CSS and HTML minifiers. The version of Hugo on NPM is slightly outdated but this is fine by me. The minifiers are used to shrink files after Hugo has generated them.</p><p>From the YAML file above, the build command that GitLab CI will call is <code>npm run build</code> which in turn runs the command found in my <code>package.json</code>. Read next section.</p><p>Note: This Docker image does not contain Python. Python is required for Pygments to work. If you have not heard of Pygments, it is a server-side <a href="https://gohugo.io/tools/syntax-highlighting/">syntax highlighter</a>. To reduce my blog&rsquo;s dependencies, I chose to replace this with <a href="https://highlightjs.org/">HighlightJS</a>, a client-side alternative.</p><h3 id="my-packagejson-file">My package.json file</h3><p>Below is a JSON file that NPM understands. It is placed at root of your Hugo source folder:</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;www.leowkahman.com&#34;</span>,
    <span style="color:#f92672">&#34;preferGlobal&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.0.1&#34;</span>,
    <span style="color:#f92672">&#34;author&#34;</span>: <span style="color:#e6db74">&#34;Leow Kah Man&#34;</span>,
    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Leow Kah Man - Tech Blog&#34;</span>,
    <span style="color:#f92672">&#34;license&#34;</span>: <span style="color:#e6db74">&#34;MIT&#34;</span>,
    <span style="color:#f92672">&#34;repository&#34;</span>: {
        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;git&#34;</span>,
        <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://gitlab.com/kmleow/kmleow.gitlab.io.git&#34;</span>
    },
    <span style="color:#f92672">&#34;engines&#34;</span>: {
        <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;&gt;=6.00&#34;</span>
    },
    <span style="color:#f92672">&#34;scripts&#34;</span>: {
        <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;hugo server --theme=leow-kah-man --buildDrafts --disableLiveReload=true&#34;</span>,
        <span style="color:#f92672">&#34;build&#34;</span>: <span style="color:#e6db74">&#34;hugo &amp;&amp; uglifycss ./public/css/custom.css --output ./public/css/custom.css &amp;&amp; html-minifier --collapse-whitespace --keep-closing-slash --file-ext html --remove-comments --minify-css true --minify-js true --input-dir public --output-dir public&#34;</span>
    },
    <span style="color:#f92672">&#34;dependencies&#34;</span>: {
        <span style="color:#f92672">&#34;html-minifier&#34;</span>: <span style="color:#e6db74">&#34;^3.5.3&#34;</span>,
        <span style="color:#f92672">&#34;hugo-bin&#34;</span>: <span style="color:#e6db74">&#34;^0.12.0&#34;</span>,
        <span style="color:#f92672">&#34;uglifycss&#34;</span>: <span style="color:#e6db74">&#34;0.0.27&#34;</span>
    }
}
</code></pre></div><ol><li>While composing Markdown files, run <code>npm start</code> so that Hugo can generate files as soon as it gets saved.</li><li>Run <code>npm run build</code> to generate files using Hugo and then minify them using <a href="https://www.npmjs.com/package/uglifycss/">UglifyCSS</a> and <a href="https://www.npmjs.com/package/html-minifier/">HTMLMinifier</a>. This command should not need to be executed by yourself unless you are testing the build process.</li></ol><h2 id="triggering-gitlab-ci">Triggering GitLab CI</h2><p>All that is left is pushing these along with Hugo source files into master branch on GitLab. The CI is triggered automatically upon performing Git push to GitLab. If the build fails, you will receive an email notification almost immediately. Otherwise, the website should be published in about a minute.</p><h2 id="additional-information">Additional information</h2><p>You can find additional information, i.e. SSL/TLS setup on custom domains under <a href="https://docs.gitlab.com/ee/user/project/pages/index.html">GitLab Pages Getting Started</a> guide.</p><ul class="list-inline tags" style="margin-left:0"><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/docker">Docker</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/firebase">Firebase</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/git">Git</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/github">GitHub</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/gitlab">GitLab</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/google">Google</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/hugo">Hugo</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/nodejs">NodeJS</a></li></ul></div></div><div class="row"><div id="disqus_thread"></div><script>!function(){if("localhost"!=window.location.hostname){var e=document.createElement("script");e.type="text/javascript",e.async=!0;e.src="https://leowkahman.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="col-sm-4 blog-sidebar"><div class="sidebar-module"><script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx=partner-pub-8585963436723502:5716828028";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><gcse:search></gcse:search></div><div class="sidebar-module"><h4>Recent Posts</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/2020/02/01/speedtest-openwrt-with-flow-offloading/">Speedtest OpenWRT with flow offloading</a></li><li><a href="https://www.leowkahman.com/2019/02/06/ultrawide-monitor-on-linux/">Ultrawide monitor on Linux</a></li><li><a href="https://www.leowkahman.com/2019/02/03/switched-from-ubuntu-to-linux-mint/">Switched from Ubuntu to Linux Mint</a></li><li><a href="https://www.leowkahman.com/2018/08/11/reduce-internet-lag-on-openwrt/">Reduce internet lag on OpenWRT</a></li><li><a href="https://www.leowkahman.com/2018/05/29/workaround-to-wifi-issues-on-openwrt-lede/">Workaround to Wi-Fi issues on OpenWRT LEDE</a></li></ul></div><div class="sidebar-module"><h4>Categories</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/categories/software/">software</a></li><li><a href="https://www.leowkahman.com/categories/web/">web</a></li><li><a href="https://www.leowkahman.com/categories/network/">network</a></li><li><a href="https://www.leowkahman.com/categories/hardware/">hardware</a></li><li><a href="https://www.leowkahman.com/categories/programming/">programming</a></li></ul></div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm-8 col-xs-6"><ul class="list-inline links"><li><a href="/privacy-policy/">Privacy Policy</a></li></ul></div><div class="col-sm-4 col-xs-6"><ul class="list-inline"><li><a target="_blank" href="/index.xml"><i class="fa fa-rss fa-lg"></i></a></li><li><a target="_blank" href="https://stackexchange.com/users/6729082/leow-kah-man"><i class="fa fa-stack-exchange fa-lg"></i></a></li><li><a target="_blank" href="https://github.com/kmleow"><i class="fa fa-github fa-lg"></i></a></li><li><a target="_blank" href="https://twitter.com/kmleow"><i class="fa fa-twitter fa-lg"></i></a></li><li><a target="_blank" href="https://www.linkedin.com/in/kmleow"><i class="fa fa-linkedin fa-lg"></i></a></li><li><a target="_blank" href="https://www.facebook.com/LeowKahMan"><i class="fa fa-facebook fa-lg"></i></a></li><li><a target="_blank" href="https://www.paypal.me/leowkahman/5usd"><i class="fa fa-paypal fa-lg"></i></a></li></ul></div></div></div><div class="container"><div class="col-sm-12 row"><p>Except as otherwise noted, the content of this page is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>,<br/>code samples are licensed under the <a href="https://tldrlegal.com/license/mit-license">MIT License</a>. Third-party product names and logos may be the trademarks of their respective owners.</p></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js" integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha256-Daf8GuI2eLKHJlOWLRR/zRy9Clqcj4TUSumbxYH9kGI=" crossorigin="anonymous"></script><script src="/js/custom.js?v=1.0.1"></script><script data-ad-client="ca-pub-8585963436723502" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-61838818-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-61838818-1")</script></body></html>