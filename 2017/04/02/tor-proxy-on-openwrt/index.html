<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-eval' 'unsafe-inline' data: https:; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https:; object-src 'self'"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>Tor proxy on OpenWRT</title><meta name="msvalidate.01" content="009F12474AB330989749B979B5868A7F"/><meta name="google-site-verification" content="in8GfCIv-CYlwD5AxO0jVMlrUy1s42a_-cxlOWdv4U0"/><meta name="yandex-verification" content="c29e9c1084b24e1d"/><meta name="description" content="If you have specific need to connect to Tor without their official browser, you can setup SOCKS5 or HTTP proxy"/><meta name="author" content="Leow Kah Man"/><link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="canonical" href="https://www.leowkahman.com/2017/04/02/tor-proxy-on-openwrt/"><link href="" rel="alternate" type="application/rss+xml" title="Leow Kah Man - Tech Blog"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous"/><link rel="stylesheet" href="/css/custom.css?v=1.0.0"/><style id="antiClickjack">body{display:none!important}</style><script>if(self===top){var antiClickjack=document.getElementById("antiClickjack");antiClickjack.parentNode.removeChild(antiClickjack)}else top.location=self.location</script><script>function redirectToCorrectDomainIfRequired(){for(var o=["www.leowkahman.com","localhost"],e=0;e<o.length;e++)if(window.location.hostname==o[e])return;window.location="https://www.leowkahman.com"+window.location.pathname}redirectToCorrectDomainIfRequired()</script></head><body><nav class="navbar navbar-default navbar-static-top"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">Leow Kah Man - Tech Blog</a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/contact/">Contact</a></li></ul></div></div></nav><div class="container"><div class="row"><div class="col-sm-12"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="7600784826" data-ad-format="auto"></ins></div></div><div class="row"><div class="col-sm-8 blog-main"><div class="row"><div class="blog-main blog-post"><h1 class="blog-post-title">Tor proxy on OpenWRT</h1><p class="blog-post-meta"><i class="fa fa-calendar"></i> Published: 2 April 2017 &nbsp;|&nbsp; <i class="fa fa-calendar-check-o"></i> Last updated: 2 April 2017 &nbsp;|&nbsp; <i class="fa fa-folder"></i> <a href="https://www.leowkahman.com/categories/web">Web</a></p><ul class="list-inline share" style="margin-top:15px;margin-left:0"><li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.leowkahman.com%2f2017%2f04%2f02%2ftor-proxy-on-openwrt%2f"><i class="fa fa-facebook fa-lg"></i> Facebook</a></li><li class="googleplus-share"><a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f04%2f02%2ftor-proxy-on-openwrt%2f"><i class="fa fa-google-plus fa-lg"></i> Google+</a></li><li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f04%2f02%2ftor-proxy-on-openwrt%2f&amp;text=Tor%20proxy%20on%20OpenWRT"><i class="fa fa-twitter fa-lg"></i> Twitter</a></li><li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f04%2f02%2ftor-proxy-on-openwrt%2f&amp;title=Tor%20proxy%20on%20OpenWRT"><i class="fa fa-reddit fa-lg"></i> Reddit</a></li><li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.leowkahman.com%2f2017%2f04%2f02%2ftor-proxy-on-openwrt%2f"><i class="fa fa-linkedin fa-lg"></i> LinkedIn</a></li></ul><p>The best way to use Tor network is by browsing using the official Tor Browser. However, if you have specific need to connect to Tor without their official browser, you can setup SOCKS5 or HTTP proxy.</p><p></p><h2 id="introduction">Introduction</h2><p>No, I am not going to tell what Tor is. That is not why you came to my blog. I could not care less about what you want to do on Tor. However, I know that the common purpose is clear, you want to use Tor for anonymity. This is especially after <a href="http://www.cnbc.com/2017/03/28/congress-clears-way-for-isps-to-sell-browsing-history.html">US congress has at the end of March 2017 given green light to ISPs to sell users&rsquo; web browsing history</a>.</p><h2 id="why-you-should-be-using-tor-browser">Why you should be using Tor Browser</h2><p>Before you proceed further below, I need to convince you that you really should be using the official <a href="https://www.torproject.org/">Tor Browser</a> to access Tor network and not via a proxy on a regular web browser. Hiding your actual IP address is not of much help to privacy if your browser is leaking its <a href="https://panopticlick.eff.org/">fingerprints</a>. The main purpose of using Tor Browser is <strong>to be like others</strong> so that you cannot be uniquely identified. Now that you have read that and if you insist on using a proxy, read on.</p><h2 id="how-to-setup-tor-proxy-on-openwrt">How to setup Tor proxy on OpenWRT</h2><h3 id="ensure-clock-on-openwrt-is-in-sync">Ensure clock on OpenWRT is in sync</h3><p>Verify that <a href="/2016/01/06/openwrt-redirect-all-ntp-queries-to-specific-servers/">system clock on your OpenWRT device is synchronised</a>.</p><h3 id="install-openwrt-packages">Install OpenWRT packages</h3><p>SSH into your OpenWRT and execute the following to install necessary packages:</p><pre><code class="language-bash">opkg update
opkg install tor
</code></pre><p>Edit <code>/etc/tor/torrc</code> and add the following line:</p><pre><code class="language-text">User tor
</code></pre><h3 id="enable-socks5-proxy-over-tor">Enable SOCKS5 proxy over Tor</h3><p>Edit <code>/etc/tor/torrc</code>:</p><p>Uncomment this line if you want to allow incoming connections only from within the router:</p><pre><code class="language-text">SOCKSPort 9050 # Default: Bind to localhost:9050 for local connections.
</code></pre><p>Uncomment this line too if you want to allow incoming connections from LAN, you need to of course change the binding address to your router&rsquo;s LAN IP:</p><pre><code class="language-text">SOCKSPort 192.168.0.1:9100 # Bind to this address:port too.
</code></pre><p>Setup accept/reject rules, i.e. if your router IP is 192.168.0.1 then setup the accept as 192.168.0.0/24:</p><pre><code class="language-text">SOCKSPolicy accept 127.0.0.1/32
SOCKSPolicy accept 192.168.0.0/24
SOCKSPolicy reject *
</code></pre><p>End of edits.</p><p>To test this, we need to restart Tor and use <code>curl</code> to verify that we really are connected to Tor:</p><pre><code class="language-bash">/etc/init.d/tor restart
#wait a few seconds for Tor to establish circuit
curl --socks5 127.0.0.1:9050 -s https://check.torproject.org/ | cat | grep -m 1 Congratulations | xargs
</code></pre><p>The output should be:</p><pre><code class="language-text">Congratulations. This browser is configured to use Tor.
</code></pre><p>Note: If you are testing against some other SSL websites, PolarSSL issues may show up. The SOCKS5 works fine but you need to connect from another machine with newer SSL libraries instead.</p><h3 id="enable-dns-proxy-over-tor">Enable DNS proxy over Tor</h3><p>Edit <code>/etc/tor/torrc</code>. Add the following line:</p><pre><code class="language-text">DNSPort 9053
</code></pre><p>To test this, we need to restart Tor and use nslookup/dig to verify:</p><pre><code class="language-bash">/etc/init.d/tor restart
#wait a few seconds for Tor to establish circuit
nslookup welcome.opendns.com localhost:9053
</code></pre><p>The output should be:</p><pre><code class="language-text">Server:    127.0.0.1
Address 1: 127.0.0.1 localhost

Name:      welcome.opendns.com
Address 1: 67.215.92.219
</code></pre><h3 id="enable-http-proxy-over-tor">Enable HTTP proxy over Tor</h3><p>Polipo is a HTTP proxy, small and fast thus ideal for routers. It is capable of proxying via SOCKS5.</p><pre><code class="language-bash">opkg install polipo
</code></pre><p>Edit <code>/etc/config/polipo</code>. Add the following lines into <code>config 'polipo' 'general'</code>. Be sure to change the LAN subnet to the correct one:</p><pre><code class="language-text">list 'allowedClients' '127.0.0.1'
list 'allowedClients' '192.168.0.0/24'
option 'socksParentProxy' 'localhost:9050'
option 'socksProxyType' 'socks5'
option 'proxyAddress' '0.0.0.0'
</code></pre><p>To test this, we need to restart Polipo and use <code>curl</code> to verify:</p><pre><code class="language-bash">/etc/init.d/polipo restart
curl --proxy 127.0.0.1:8123 -s https://check.torproject.org/ | cat | grep -m 1 Congratulations | xargs
</code></pre><p>The output should of course be:</p><pre><code class="language-text">Congratulations. This browser is configured to use Tor.
</code></pre><ul class="list-inline tags" style="margin-left:0"><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/openwrt">OpenWRT</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/proxy">proxy</a></li><li class="btn btn-primary"><a href="https://www.leowkahman.com/tags/tor">Tor</a></li></ul></div></div><div class="row"><h4>Support Me</h4><p>If this post helped you, would you buy me a cup of tea/coffee?</p><a title="PayPal" href="https://www.paypal.me/leowkahman/12"><i class="fa fa-2x fa-paypal"></i> </a>&nbsp;&nbsp; <a title="Bitcoin" href="bitcoin:14vH7vDj7eyvvc7mxCkrgTx2HUntpeKhAn?amount=0.001&amp;label=Tech%20Blog"><i class="fa fa-2x fa-btc"></i> </a><a title="Bitcoin QR code" href="/images/bitcoin.png"><i class="fa fa-2x fa-qrcode"></i></a></div><div class="blog-post"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="8937917223" data-ad-format="auto"></ins></div><div class="row"><div id="disqus_thread"></div><script>!function(){if("localhost"!=window.location.hostname){var e=document.createElement("script");e.type="text/javascript",e.async=!0;e.src="https://leowkahman.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="col-sm-4 blog-sidebar"><div class="sidebar-module"><script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx=partner-pub-8585963436723502:5716828028";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><gcse:search></gcse:search></div><div class="sidebar-module"><h4>Recent Posts</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/2018/01/09/setup-nodejs-with-apache-proxypass-on-raspberry-pi/">Setup NodeJS with Apache ProxyPass on Raspberry Pi</a></li><li><a href="https://www.leowkahman.com/2018/01/02/workaround-to-failure-to-download-extra-files-ttf-mscorefonts-installer/">Workaround to Failure to download extra files ttf-mscorefonts-installer</a></li><li><a href="https://www.leowkahman.com/2017/12/31/solution-to-lag-during-dota-2-alchemist-acid-spray-on-ubuntu-17-10/">Solution to lag during DOTA 2 Alchemist acid spray on Ubuntu 17.10</a></li><li><a href="https://www.leowkahman.com/2017/12/29/cloud-storage-solutions-for-linux/">Cloud storage solutions for Linux</a></li><li><a href="https://www.leowkahman.com/2017/12/22/cruising-on-quantum-of-the-seas/">Cruising on Quantum of the Seas</a></li></ul></div><div class="sidebar-module"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8585963436723502" data-ad-slot="6069940020" data-ad-format="auto"></ins></div><div class="sidebar-module"><h4>Categories</h4><ul class="list-unstyled posts-recent"><li><a href="https://www.leowkahman.com/categories/web/">web</a></li><li><a href="https://www.leowkahman.com/categories/network/">network</a></li><li><a href="https://www.leowkahman.com/categories/software/">software</a></li><li><a href="https://www.leowkahman.com/categories/hardware/">hardware</a></li><li><a href="https://www.leowkahman.com/categories/cloud/">cloud</a></li></ul></div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm-8 col-xs-6"><ul class="list-inline links"><li><a href="https://status.leowkahman.com/">Uptime</a></li></ul></div><div class="col-sm-4 col-xs-6"><ul class="list-inline"><li><a target="_blank" href="/index.xml"><i class="fa fa-rss fa-lg"></i></a></li><li><a target="_blank" href="https://stackexchange.com/users/6729082/leow-kah-man"><i class="fa fa-stack-exchange fa-lg"></i></a></li><li><a target="_blank" href="https://github.com/kmleow"><i class="fa fa-github fa-lg"></i></a></li><li><a target="_blank" href="https://www.linkedin.com/in/kmleow"><i class="fa fa-linkedin fa-lg"></i></a></li><li><a target="_blank" href="https://www.facebook.com/LeowKahMan"><i class="fa fa-facebook fa-lg"></i></a></li></ul></div></div></div><div class="container"><div class="col-sm-12 row"><p>Except as otherwise noted, the content of this page is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>,<br/>code samples are licensed under the <a href="https://tldrlegal.com/license/mit-license">MIT License</a>.</p></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha256-Daf8GuI2eLKHJlOWLRR/zRy9Clqcj4TUSumbxYH9kGI=" crossorigin="anonymous"></script><script src="/js/custom.js?v=1.0.1"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>[].forEach.call(document.querySelectorAll(".adsbygoogle"),function(){(adsbygoogle=window.adsbygoogle||[]).push({})})</script><script>!function(e,a,t,n,c,g,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,g=a.createElement("script"),o=a.getElementsByTagName("script")[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(g,o)}(window,document),ga("create","UA-61838818-1","auto"),ga("send","pageview"),ga("set","forceSSL",!0)</script></body></html>